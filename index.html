<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-translate-key="title">ğŸ§© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* ÙÙˆÙ†Øª Ú©Ù„ÛŒ ØªÙ…Ø§Ù… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    button {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    /* Root Variables */
    :root {
      --primary: #4a90e2;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
    }
    /* Default styles */
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .component {
      background: white;
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
    .log-entry {
      padding: 8px;
      margin: 5px 0;
      border-left: 3px solid;
      animation: slideIn 0.3s;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
    }
    .phase {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .data-item {
      padding: 5px;
      margin: 3px;
      background: #f8f9fa;
      border-radius: 3px;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    /* Dark Mode styles */
    .dark-mode {
      background: #343a40;
      color: #f8f9fa;
    }
    .dark-mode .component {
      background: #495057;
      border-color: #6c757d;
      color: #f8f9fa;
    }
    .dark-mode .data-item {
      background: #6c757d;
    }
    .dark-mode .phase.alert {
      background: #6c757d;
      border-color: #adb5bd;
      color: #f8f9fa;
    }
    .dark-mode .log-entry {
      background: #495057;
    }
    .theme-toggle {
      transition: background 0.3s ease, color 0.3s ease;
    }
    /* Custom style for new transaction button (light green) */
    .btn-new {
      background-color: #90ee90;
      color: #000;
      border-color: #90ee90;
    }
    .dark-mode .btn-new {
      background-color: #76c776;
      color: #fff;
      border-color: #76c776;
    }
    /* Custom style for disk toggle button */
    .btn-disk {
      background-color: #007bff;
      color: #fff;
      border-color: #007bff;
    }
    .dark-mode .btn-disk {
      background-color: #0056b3;
      color: #fff;
      border-color: #0056b3;
    }
    /* Select dropdown arrow in dark mode */
    .dark-mode .form-select {
      background: #495057 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%23fff' d='M2 0L0 2h4L2 0z'/%3E%3C/svg%3E") no-repeat right 0.75rem center;
      background-size: 8px 10px;
      color: #f8f9fa;
      border-color: #6c757d;
    }
    /* Modal dark mode content */
    .dark-mode .modal-content {
      background-color: #495057;
      color: #f8f9fa;
    }
    /* Reposition and style modal close button */
    .modal-header {
      position: relative;
      padding-left: 50px;
    }
    .modal-header .btn-close {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 32px;
      height: 32px;
      background-image: url("data:image/svg+xml;charset=utf8,<svg xmlns='http://www.w3.org/2000/svg' fill='%23dc3545' viewBox='0 0 16 16'><path d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg>");
      background-repeat: no-repeat;
      background-size: 16px 16px;
      border: none;
      opacity: 1;
    }
    /* Grouping buttons in columns using d-grid */
    .btn-group-custom {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <!-- Main Title -->
    <h1 id="mainTitle" class="text-center mb-4" data-translate-key="title">ğŸ§© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</h1>

    <!-- Row for button groups -->
    <div class="row justify-content-center g-3">
      <!-- Group 1: Transaction Operations -->
      <div class="col-md-2">
        <div class="d-grid gap-2">
          <button id="btnNewTransaction" class="btn btn-new" onclick="createTransaction()" data-translate-key="newTransaction" data-tooltip-key="tooltipNewTransaction">â• ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯</button>
          <button id="btnCommit" class="btn btn-success" onclick="commitAllTransactions()" data-translate-key="commitAll" data-tooltip-key="tooltipCommitAll">âœ… ØªØ§ÛŒÛŒØ¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
        </div>
      </div>

      <!-- Group 2: System Operations -->
      <div class="col-md-3">
        <div class="d-grid gap-2">
          <button id="btnCheckpoint" class="btn btn-warning" onclick="createCheckpoint()" data-translate-key="checkpoint" data-tooltip-key="tooltipCheckpoint">ğŸ”– Ú†Ú© Ù¾ÙˆÛŒÙ†Øª</button>
          <button id="btnSimulateFailure" class="btn btn-danger" onclick="simulateFailure()" data-translate-key="simulateFailure" data-tooltip-key="tooltipSimulateFailure">ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§</button>
          <button id="btnFlushBuffer" class="btn btn-secondary" onclick="flushBuffer()" data-translate-key="flushBuffer" data-tooltip-key="tooltipFlushBuffer">ğŸ’¾ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ±</button>
          <button id="btnToggleDisk" class="btn btn-disk" onclick="toggleDiskStatus()" data-translate-key="toggleDisk" data-tooltip-key="tooltipToggleDisk">ğŸ’¿ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú©</button>
        </div>
      </div>

      <!-- Group 3: Scenario Selection -->
      <div class="col-md-3">
        <div class="d-grid gap-2">
          <select id="scenarioSelector" class="form-select" data-tooltip-key="tooltipRunScenario">
            <option value="normal" data-translate-key="scenarioNormal">ğŸƒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¹Ø§Ø¯ÛŒ</option>
            <option value="transaction-fail" data-translate-key="scenarioTransactionFail">ğŸ’¥ Ø´Ú©Ø³Øª ØªØ±Ø§Ú©Ù†Ø´</option>
            <option value="system-crash" data-translate-key="scenarioSystemCrash">ğŸ–¥ Ø´Ú©Ø³Øª Ø³ÛŒØ³ØªÙ…</option>
            <option value="two-phase" data-translate-key="scenarioTwoPhase">ğŸ¤ Two-Phase Commit</option>
          </select>
          <button id="btnRunScenario" class="btn btn-warning" onclick="runScenario()" data-translate-key="runScenario" data-tooltip-key="tooltipRunScenario">â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ</button>
          <button id="btnDump" class="btn btn-primary" onclick="simulateDump()" data-translate-key="simulateDump" data-tooltip-key="tooltipDump">ğŸ“„ Ø¯Ø§Ù…Ù¾</button>
        </div>
      </div>

      <!-- Group 4: Reset, Redo, Undo & Clear Logs -->
      <div class="col-md-2">
        <div class="d-grid gap-2">
          <button id="btnResetSystem" class="btn btn-dark" onclick="resetSystem()" data-translate-key="resetSystem" data-tooltip-key="tooltipResetSystem">ğŸ”„ Ø±ÛŒØ³Øª Ø³ÛŒØ³ØªÙ…</button>
          <button id="btnRedo" class="btn btn-info" onclick="executeRedo()" data-translate-key="redo" data-tooltip-key="tooltipRedo">â†ªï¸ Redo</button>
          <button id="btnUndo" class="btn btn-warning" onclick="undoLastTransaction()" data-tooltip-key="tooltipUndo">â†©ï¸ Undo</button>
          <button id="btnClearLogs" class="btn btn-outline-danger" onclick="clearLogs()" data-translate-key="clearLogs" data-tooltip-key="tooltipClearLogs">ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§</button>
        </div>
      </div>

      <!-- Group 5: Settings -->
      <div class="col-md-2">
        <div class="d-grid gap-2">
          <button id="btnToggleTheme" class="btn btn-outline-secondary theme-toggle" onclick="toggleDarkMode()" data-translate-key="changeTheme" data-tooltip-key="tooltipToggleTheme">ğŸŒ™ ØªØºÛŒÛŒØ± ØªÙ…</button>
          <button id="btnAbout" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#aboutModal" data-translate-key="about" data-tooltip-key="tooltipAbout">â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</button>
          <button id="btnGuide" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#guideModal" data-translate-key="guide" data-tooltip-key="tooltipGuide">ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§</button>
          <button id="btnToggleLanguage" class="btn btn-outline-primary" onclick="toggleLanguage()" data-translate-key="switchLanguage" data-tooltip-key="tooltipToggleLanguage">English</button>
        </div>
      </div>
    </div>

    <!-- System Status Sections -->
    <div class="row">
      <!-- Data Status -->
      <div class="col-md-4">
        <div class="component">
          <h4 data-translate-key="dataStatus">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h4>
          <div class="mt-3">
            <div class="data-item">A: <span id="dataA">1000</span></div>
            <div class="data-item">B: <span id="dataB">2000</span></div>
          </div>
        </div>
      </div>
      <!-- Storage Status -->
      <div class="col-md-4">
        <div class="component">
          <h4 data-translate-key="storageStatus">ğŸ’¾ ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ</h4>
          <div class="mt-3">
            <h5 data-translate-key="mainMemory">Ø­Ø§ÙØ¸Ù‡ Ø§ØµÙ„ÛŒ:</h5>
            <div id="bufferState" data-translate-key="bufferLabel">Ø¨Ø§ÙØ±: <span id="bufferedData">0</span></div>
            <div id="bufferContent" class="mt-2"></div>
          </div>
          <div class="mt-3">
            <h5 data-translate-key="diskLabel">Ø¯ÛŒØ³Ú©:</h5>
            <div id="diskState" class="text-success"></div>
            <div data-translate-key="lastCheckpointLabel">
              Ø¢Ø®Ø±ÛŒÙ† Checkpoint: <span id="lastCheckpoint"></span>
            </div>
          </div>
        </div>
      </div>
      <!-- Transactions Status -->
      <div class="col-md-4">
        <div class="component">
          <h4 data-translate-key="transactionStatus">ğŸ“‘ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h4>
          <div id="transactions" class="mt-3"></div>
        </div>
      </div>
    </div>

    <!-- System Logs -->
    <div class="component mt-4">
      <h4 data-translate-key="systemLogs">ğŸ“œ Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ…</h4>
      <div id="systemLogs" class="mt-3"></div>
    </div>
  </div>

  <!-- About Modal -->
  <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="aboutModalLabel" class="modal-title" data-translate-key="about">â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¨Ø³ØªÙ†"></button>
        </div>
        <div class="modal-body">
          <p><strong data-translate-key="aboutDeveloper">Ø­Ù…ÛŒØ¯Ø±Ø¶Ø§ Ù…Ù‡Ø±Ø¢Ø¨Ø§Ø¯ÛŒ</strong></p>
          <p data-translate-key="aboutProject">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¬Ù‡Øª Ù†Ù…Ø§ÛŒØ´ Ù…ÙØ§Ù‡ÛŒÙ… ØªØ±Ø§Ú©Ù†Ø´ØŒ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ±ØŒ CheckpointØŒ Undo/Redo Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</p>
          <p><strong>Ù„ÛŒÙ†Ú©:</strong> <a href="https://github.com/hmplus28" target="_blank" data-translate-key="aboutLink">github.com/hmplus28</a></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate-key="closeBtn">âŒ Ø¨Ø³ØªÙ†</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Guide Modal -->
  <div class="modal fade" id="guideModal" tabindex="-1" aria-labelledby="guideModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="guideModalLabel" class="modal-title" data-translate-key="guide">ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¨Ø³ØªÙ†"></button>
        </div>
        <div class="modal-body">
          <h5 data-translate-key="guideIntroTitle">Ù…Ù‚Ø¯Ù…Ù‡</h5>
          <p data-translate-key="guideIntroText">
            Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… ÛŒÚ© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª Ú©Ù‡ Ù…ÙØ§Ù‡ÛŒÙ… ØªØ±Ø§Ú©Ù†Ø´ØŒ CheckpointØŒ Undo/RedoØŒ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ± Ùˆ Ø³Ø§ÛŒØ± Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡ Ø±Ø§ Ø¨Ù‡ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯.
          </p>
          <h5 data-translate-key="guideUsageTitle">Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡</h5>
          <ul>
            <li data-translate-key="guideUsageNewTransaction"><strong data-translate-key="newTransaction">â• ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯:</strong> Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ø´Ø§Ù…Ù„ Ø®ÙˆØ§Ù†Ø¯Ù† Ùˆ Ù†ÙˆØ´ØªÙ†.</li>
            <li data-translate-key="guideUsageCheckpoint"><strong data-translate-key="checkpoint">ğŸ”– Checkpoint:</strong> Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§.</li>
            <li data-translate-key="guideUsageFailure"><strong data-translate-key="simulateFailure">ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§:</strong> Ø§ÛŒØ¬Ø§Ø¯ Ø®Ø·Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Undo.</li>
            <li data-translate-key="guideUsageRedo"><strong data-translate-key="redo">â†ªï¸ Redo:</strong> Ø§Ø¹Ù…Ø§Ù„ Ù…Ø¬Ø¯Ø¯ ØªØºÛŒÛŒØ±Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡ Ø¯Ø± Ù„Ø§Ú¯.</li>
            <li data-translate-key="guideUsageFlushBuffer"><strong data-translate-key="flushBuffer">ğŸ’¾ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ±:</strong> Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ÙØ± Ø¨Ù‡ Ø­Ø§ÙØ¸Ù‡ Ø§ØµÙ„ÛŒ.</li>
            <li data-translate-key="guideUsageReset"><strong data-translate-key="resetSystem">ğŸ”„ Ø±ÛŒØ³Øª Ø³ÛŒØ³ØªÙ…:</strong> Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡.</li>
            <li data-translate-key="guideUsageDump"><strong data-translate-key="simulateDump">ğŸ“„ Dump:</strong> Ø§Ø¬Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Dump Ø·Ø¨Ù‚ Ù…Ø±Ø§Ø­Ù„ Ø²ÛŒØ±:
              <ul>
                <li data-translate-key="dumpStep1">âŒ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ø§Ù„</li>
                <li data-translate-key="dumpStep2">ğŸ“œ Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡ Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø±</li>
                <li data-translate-key="dumpStep3">ğŸ’¾ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ± Ø¨Ù‡ Ø¯ÛŒØ³Ú©</li>
                <li data-translate-key="dumpStep4">ğŸ—„ Ú©Ù¾ÛŒ Ù…Ø­ØªÙˆÛŒØ§Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø±</li>
                <li data-translate-key="dumpStep5">ğŸ“ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯ Ù„Ø§Ú¯ &lt;dump&gt;</li>
              </ul>
            </li>
            <li data-translate-key="guideUsageTheme"><strong data-translate-key="changeTheme">ğŸŒ™ ØªØºÛŒÛŒØ± ØªÙ…:</strong> Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¨ÛŒÙ† Ø­Ø§Ù„Øª Ù†Ø±Ù…Ø§Ù„ Ùˆ Ø¯Ø§Ø±Ú©.</li>
            <li data-translate-key="guideUsageLanguage"><strong data-translate-key="switchLanguage">English:</strong> ØªØºÛŒÛŒØ± Ú©Ù„ Ù…Ø­ØªÙˆØ§ Ø¨ÛŒÙ† ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ.</li>
            <li data-translate-key="guideUsageDiskToggle">
                <strong data-translate-key="toggleDisk">ğŸ’¿ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú©:</strong>
                ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© Ø¨ÛŒÙ† Ø³Ø§Ù„Ù… Ùˆ Ø®Ø±Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø±Ø§ÛŒØ· Ù…Ø®ØªÙ„Ù
              </li>
              <li data-translate-key="guideUsageClearLogs">
                <strong data-translate-key="clearLogs">ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§:</strong>
                Ø­Ø°Ù ØªÙ…Ø§Ù…ÛŒ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ… Ø¨Ø¯ÙˆÙ† ØªØ§Ø«ÛŒØ± Ø¨Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
              </li>
          </ul>
          <h5 data-translate-key="guideExampleTitle">Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÛŒ</h5>
          <p data-translate-key="guideExampleText">
            Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ "â• ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø´ÙˆØ¯. Ø³Ù¾Ø³ Ø¨Ø§ "ğŸ”– Checkpoint" ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆØ¯. Ø¨Ø¹Ø¯ Ø¨Ø§ "ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§" Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Undo Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯. Ù†Ù‡Ø§ÛŒØªØ§Ù‹ Ø¨Ø§ "â†ªï¸ Redo" ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ø¹Ù…Ø§Ù„ Ùˆ Ø¨Ø§ "ğŸ“„ Dump" Ø¹Ù…Ù„ÛŒØ§Øª Dump Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate-key="closeBtn">âŒ Ø¨Ø³ØªÙ†</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Global language state
    let currentLanguage = "fa";

    // Transaction counter for unique IDs
    let transactionCounter = 0;

    // Translation dictionary (including tooltips)
    const translations = {
      title: { fa: "ğŸ§© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡", en: "ğŸ§© Full Database Recovery Simulator" },
      newTransaction: { fa: "â• ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯", en: "â• New Transaction" },
      checkpoint: { fa: "ğŸ”– Ú†Ú© Ù¾ÙˆÛŒÙ†Øª", en: "ğŸ”– Checkpoint" },
      simulateFailure: { fa: "ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§", en: "ğŸ’¥ Simulate Failure" },
      redo: { fa: "â†ªï¸ Redo", en: "â†ªï¸ Redo" },
      flushBuffer: { fa: "ğŸ’¾ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ±", en: "ğŸ’¾ Flush Buffer" },
      resetSystem: { fa: "ğŸ”„ Ø±ÛŒØ³Øª Ø³ÛŒØ³ØªÙ…", en: "ğŸ”„ Reset System" },
      simulateDump: { fa: "ğŸ“„ Ø¯Ø§Ù…Ù¾", en: "ğŸ“„ Dump" },
      runScenario: { fa: "â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ", en: "â–¶ï¸ Run Scenario" },
      changeTheme: { fa: "ğŸŒ™ ØªØºÛŒÛŒØ± ØªÙ…", en: "ğŸŒ™ Toggle Theme" },
      about: { fa: "â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§", en: "â„¹ï¸ About Us" },
      guide: { fa: "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§", en: "ğŸ“š Guide" },
      switchLanguage: { fa: "English", en: "ÙØ§Ø±Ø³ÛŒ" },
      dataStatus: { fa: "ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§", en: "ğŸ“Š Data Status" },
      storageStatus: { fa: "ğŸ’¾ ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ", en: "ğŸ’¾ Storage Status" },
      transactionStatus: { fa: "ğŸ“‘ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§", en: "ğŸ“‘ Transactions" },
      systemLogs: { fa: "ğŸ“œ Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ…", en: "ğŸ“œ System Logs" },
      scenarioNormal: { fa: "ğŸƒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¹Ø§Ø¯ÛŒ", en: "ğŸƒ Normal Scenario" },
      scenarioTransactionFail: { fa: "ğŸ’¥ Ø´Ú©Ø³Øª ØªØ±Ø§Ú©Ù†Ø´", en: "ğŸ’¥ Transaction Failure" },
      scenarioSystemCrash: { fa: "ğŸ–¥ Ø´Ú©Ø³Øª Ø³ÛŒØ³ØªÙ…", en: "ğŸ–¥ System Crash" },
      scenarioTwoPhase: { fa: "ğŸ¤ Two-Phase Commit", en: "ğŸ¤ Two-Phase Commit" },
      commitAll: { fa: "âœ… ØªØ§ÛŒÛŒØ¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§", en: "âœ… Commit All Transactions" },
      clearLogs: { fa: "ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§", en: "ğŸ—‘ Clear Logs" },
      tooltipNewTransaction: { fa: "Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯", en: "Create a new transaction" },
      tooltipCommitAll: { fa: "ØªØ§ÛŒÛŒØ¯ ØªÙ…Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„", en: "Commit all active transactions" },
      tooltipCheckpoint: { fa: "Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ú†Ú© Ù¾ÙˆÛŒÙ†Øª", en: "Create a checkpoint" },
      tooltipSimulateFailure: { fa: "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ú©Ø³Øª ØªØ±Ø§Ú©Ù†Ø´", en: "Simulate a transaction failure" },
      tooltipFlushBuffer: { fa: "ÙÙ„Ø§Ø´ Ú©Ø±Ø¯Ù† Ø¨Ø§ÙØ± Ø¨Ù‡ Ø¯ÛŒØ³Ú©", en: "Flush the buffer to disk" },
      tooltipToggleDisk: { fa: "ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© (Ø³Ø§Ù„Ù…/Ø®Ø±Ø§Ø¨)", en: "Toggle disk status (Healthy/Broken)" },
      tooltipRunScenario: { fa: "Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡", en: "Run the selected scenario" },
      tooltipDump: { fa: "Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø² ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…", en: "Dump the system state" },
      tooltipResetSystem: { fa: "Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø³ÛŒØ³ØªÙ…", en: "Reset the system" },
      tooltipRedo: { fa: "Ø§Ø¹Ù…Ø§Ù„ Ù…Ø¬Ø¯Ø¯ ØªØºÛŒÛŒØ±Ø§Øª", en: "Redo changes" },
      tooltipClearLogs: { fa: "Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù„Ø§Ú¯â€ŒÙ‡Ø§", en: "Clear all logs" },
      tooltipToggleTheme: { fa: "ØªØºÛŒÛŒØ± ØªÙ…", en: "Toggle theme" },
      tooltipAbout: { fa: "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø³ÛŒØ³ØªÙ…", en: "About this system" },
      tooltipGuide: { fa: "Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³ÛŒØ³ØªÙ…", en: "Usage guide" },
      tooltipToggleLanguage: { fa: "ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†", en: "Toggle language" },
      tooltipUndo: { fa: "Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡", en: "Undo the last committed transaction" },
      tooltipDeleteTransaction: { fa: "Ø­Ø°Ù Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´", en: "Delete this transaction" },
      // Memory section translations
      mainMemory: { fa: "Ø­Ø§ÙØ¸Ù‡ Ø§ØµÙ„ÛŒ:", en: "Main Memory:" },
      bufferLabel: { fa: "Ø¨Ø§ÙØ±:", en: "Buffer:" },
      // Ø­Ø°Ù Ù„Ø§Ú¯ Ø­Ø§ÙØ¸Ù‡ Ú†ÙˆÙ† Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†ÛŒØ³Øª
      diskLabel: { fa: "Ø¯ÛŒØ³Ú©:", en: "Disk:" },
      diskStatusLabel: { fa: "ÙˆØ¶Ø¹ÛŒØª:", en: "Status:" },
      lastCheckpointLabel: { fa: "Ø¢Ø®Ø±ÛŒÙ† Checkpoint:", en: "Last Checkpoint:" },
      noCheckpoint: { fa: "Ù†Ø¯Ø§Ø±Ø¯", en: "None" },
      // Guide modal translations
      guideIntroTitle: { fa: "Ù…Ù‚Ø¯Ù…Ù‡", en: "Introduction" },
      guideIntroText: { fa: "Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… ÛŒÚ© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª Ú©Ù‡ Ù…ÙØ§Ù‡ÛŒÙ… ØªØ±Ø§Ú©Ù†Ø´ØŒ CheckpointØŒ Undo/RedoØŒ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ± Ùˆ Ø³Ø§ÛŒØ± Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡ Ø±Ø§ Ø¨Ù‡ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯.", en: "This system is a full database recovery simulator demonstrating transactions, checkpoint, undo/redo, buffer flush, and related data management operations." },
      guideUsageTitle: { fa: "Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡", en: "How to Use" },
      guideUsageNewTransaction: { fa: "â• ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯: Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ø´Ø§Ù…Ù„ Ø®ÙˆØ§Ù†Ø¯Ù† Ùˆ Ù†ÙˆØ´ØªÙ†.", en: "â• New Transaction: Creates a transaction with read/write operations." },
      guideUsageCheckpoint: { fa: "ğŸ”– Checkpoint: Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§.", en: "ğŸ”– Checkpoint: Saves current system state for recovery in case of failure." },
      guideUsageFailure: { fa: "ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§: Ø§ÛŒØ¬Ø§Ø¯ Ø®Ø·Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Undo.", en: "ğŸ’¥ Simulate Failure: Randomly fail an active transaction and execute Undo." },
      guideUsageRedo: { fa: "â†ªï¸ Redo: Ø§Ø¹Ù…Ø§Ù„ Ù…Ø¬Ø¯Ø¯ ØªØºÛŒÛŒØ±Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡ Ø¯Ø± Ù„Ø§Ú¯.", en: "â†ªï¸ Redo: Reapply changes recorded in logs." },
      guideUsageFlushBuffer: { fa: "ğŸ’¾ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ±: Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ÙØ± Ø¨Ù‡ Ø­Ø§ÙØ¸Ù‡ Ø§ØµÙ„ÛŒ.", en: "ğŸ’¾ Flush Buffer: Transfer buffered data to main storage." },
      guideUsageReset: { fa: "ğŸ”„ Ø±ÛŒØ³Øª Ø³ÛŒØ³ØªÙ…: Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡.", en: "ğŸ”„ Reset System: Reset the system to its initial state." },
      guideUsageDump: { fa: "ğŸ“„ Dump: Ø§Ø¬Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Dump Ø·Ø¨Ù‚ Ù…Ø±Ø§Ø­Ù„ Ø²ÛŒØ±.", en: "ğŸ“„ Dump: Execute the dump operations as follows." },
      guideUsageTheme: { fa: "ğŸŒ™ ØªØºÛŒÛŒØ± ØªÙ…: Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¨ÛŒÙ† Ø­Ø§Ù„Øª Ù†Ø±Ù…Ø§Ù„ Ùˆ Ø¯Ø§Ø±Ú©.", en: "ğŸŒ™ Toggle Theme: Switch between normal and dark modes." },
      guideUsageLanguage: { fa: "English: ØªØºÛŒÛŒØ± Ú©Ù„ Ù…Ø­ØªÙˆØ§ Ø¨ÛŒÙ† ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ.", en: "English: Toggle all content between Persian and English." },
      guideExampleTitle: { fa: "Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÛŒ", en: "Example" },
      guideExampleText: { fa: "Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ 'â• ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯' Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø´ÙˆØ¯. Ø³Ù¾Ø³ Ø¨Ø§ 'ğŸ”– Checkpoint' ÙˆØ¶Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆØ¯. Ø¨Ø¹Ø¯ Ø¨Ø§ 'ğŸ’¥ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§' Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Undo Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯. Ù†Ù‡Ø§ÛŒØªØ§Ù‹ Ø¨Ø§ 'â†ªï¸ Redo' ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ø¹Ù…Ø§Ù„ Ùˆ Ø¨Ø§ 'ğŸ“„ Dump' Ø¹Ù…Ù„ÛŒØ§Øª Dump Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.", en: "First click 'New Transaction' to create a transaction. Then click 'Checkpoint' to save the state. Next, click 'Simulate Failure' to see Undo in action. Finally, 'Redo' reapplies changes and 'Dump' executes the dump operations." },

  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
  noBuffer: { fa: "Ø®Ø§Ù„ÛŒ", en: "Empty" },
  guideUsageDiskToggle: {
    fa: "ğŸ’¿ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú©: ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© Ø¨ÛŒÙ† Ø³Ø§Ù„Ù… Ùˆ Ø®Ø±Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø±Ø§ÛŒØ· Ù…Ø®ØªÙ„Ù",
    en: "ğŸ’¿ Toggle Disk: Switch disk status between healthy/broken for different scenarios"
  },
  guideUsageClearLogs: {
    fa: "ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§: Ø­Ø°Ù ØªÙ…Ø§Ù…ÛŒ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ… Ø¨Ø¯ÙˆÙ† ØªØ§Ø«ÛŒØ± Ø¨Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§",
    en: "ğŸ—‘ Clear Logs: Delete all system log records without affecting data"
  },
  // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… Ú†Ú© Ù¾ÙˆÛŒÙ†Øª
  noCheckpoint: { fa: "Ù†Ø¯Ø§Ø±Ø¯", en: "None" }

    };

    // Update tooltips for elements with data-tooltip-key
    function updateTooltips() {
      document.querySelectorAll("[data-tooltip-key]").forEach(el => {
        const key = el.getAttribute("data-tooltip-key");
        if(translations[key] && translations[key][currentLanguage]){
          el.title = translations[key][currentLanguage];
        }
      });
    }

    // Update all elements with data-translate-key attribute
    function updateLanguage() {
      document.querySelectorAll("[data-translate-key]").forEach(el => {
        const key = el.getAttribute("data-translate-key");
        if(translations[key] && translations[key][currentLanguage]) {
          el.innerText = translations[key][currentLanguage];
        }
      });
      document.title = translations.title[currentLanguage];
      if(currentLanguage === "en") {
        document.documentElement.setAttribute("dir", "ltr");
        document.documentElement.setAttribute("lang", "en");
      } else {
        document.documentElement.setAttribute("dir", "rtl");
        document.documentElement.setAttribute("lang", "fa");
      }
      updateTooltips();
      updateUI();
    }

    function toggleLanguage() {
      currentLanguage = currentLanguage === "fa" ? "en" : "fa";
      updateLanguage();
    }

    // Initial system object with stableDB property added
    let system = {
      data: { A: 1000, B: 2000 },
      transactions: [],
      logs: [],
      checkpoints: [],
      buffer: [],
      diskStatus: "Ø³Ø§Ù„Ù…",
      stableDB: {},
      logStorage: {
        active: [],
        archive: []
      }
    };

    // Function to commit all active transactions
    function commitAllTransactions() {
      let committed = false;
      system.transactions.forEach(t => {
        if(t.state === "ÙØ¹Ø§Ù„") {
          t.state = "ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡";
          addLog(currentLanguage === "fa" ? `âœ… ØªØ±Ø§Ú©Ù†Ø´ ${t.id} ØªØ§ÛŒÛŒØ¯ Ø´Ø¯` : `âœ… Transaction ${t.id} committed`, "success");
          committed = true;
        }
      });
      if(!committed) {
        addLog(currentLanguage === "fa" ? "âš ï¸ Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ commit ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!" : "âš ï¸ No active transaction available for commit!", "warning");
      }
      updateUI();
    }

    // Function to clear all logs (without affecting data or transactions)
    function clearLogs() {
      document.getElementById("systemLogs").innerHTML = "";
    }

    // Function to undo the last committed transaction
    function undoLastTransaction() {
      for(let i = system.transactions.length - 1; i >= 0; i--){
        if(system.transactions[i].state === "ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡"){
          executeUndo(system.transactions[i]);
          system.transactions[i].state = "Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯Ù‡";
          addLog(currentLanguage === "fa" ? `â†©ï¸ ØªØ±Ø§Ú©Ù†Ø´ ${system.transactions[i].id} Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯` : `â†©ï¸ Transaction ${system.transactions[i].id} undone`, "warning");
          updateUI();
          return;
        }
      }
      addLog(currentLanguage === "fa" ? "âš ï¸ Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!" : "âš ï¸ No committed transaction available to undo!", "warning");
    }

    // Function to delete a transaction by id
    function deleteTransaction(id) {
      system.transactions = system.transactions.filter(t => t.id !== id);
      addLog(currentLanguage === "fa" ? `âŒ ØªØ±Ø§Ú©Ù†Ø´ ${id} Ø­Ø°Ù Ø´Ø¯` : `âŒ Transaction ${id} deleted`, "info");
      updateUI();
    }

    // Scenario definitions
    const scenarios = {
      "normal": () => {
        addLog(currentLanguage === "fa" ? "ğŸƒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¹Ø§Ø¯ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯" : "ğŸƒ Normal scenario started", "info");
        createTransaction();
        createTransaction();
      },
     "transaction-fail": () => {
  addLog("ğŸ’¥ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø´Ú©Ø³Øª ØªØ±Ø§Ú©Ù†Ø´ Ø´Ø±ÙˆØ¹ Ø´Ø¯", "info");

  // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ùˆ ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ ØªØ§Ø®ÛŒØ± Ø¨ÛŒÙ† Ø¢Ù†Ù‡Ø§
  createTransaction();
  setTimeout(() => {
    createTransaction();

    // ØªØ§Ø®ÛŒØ± Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
    setTimeout(() => {
      const activeTransactions = system.transactions.filter(t => t.state === "ÙØ¹Ø§Ù„");
      addLog(`ğŸ” ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„: ${activeTransactions.length} Ø¹Ø¯Ø¯`, "info");

      if(activeTransactions.length === 0) {
        addLog("âš ï¸ Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!", "warning");
        return;
      }

      const failedTrans = activeTransactions[Math.floor(Math.random() * activeTransactions.length)];
      addLog(`ğŸ¯ Ø§Ù†ØªØ®Ø§Ø¨ ØªØ±Ø§Ú©Ù†Ø´ ${failedTrans.id} Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª`, "info");

      failedTrans.state = "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡";
      addLog(`ğŸ’¥ ØªØ±Ø§Ú©Ù†Ø´ ${failedTrans.id} Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯`, "danger");

      // Ù†Ù…Ø§ÛŒØ´ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ
      addLog(`ğŸ“Š Ù…Ù‚Ø§Ø¯ÛŒØ± Ù‚Ø¨Ù„ Ø§Ø² Undo - A: ${system.data.A}, B: ${system.data.B}`, "warning");

      // Ø§Ø¬Ø±Ø§ÛŒ Undo
      failedTrans.operations.slice().reverse().forEach(op => {
        if(op.type === "write") {
          const before = system.data[op.item];
          system.data[op.item] = op.old;
          addLog(`â†©ï¸ ${op.item} Ø§Ø² ${before} Ø¨Ù‡ ${op.old} Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯`, "success");
        }
      });

      // Ù†Ù…Ø§ÛŒØ´ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ
      addLog(`ğŸ“Š Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø³ Ø§Ø² Undo - A: ${system.data.A}, B: ${system.data.B}`, "success");
      updateUI();

    }, 1500); // ØªØ§Ø®ÛŒØ± Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ø¯ÙˆÙ…
  }, 500); // ØªØ§Ø®ÛŒØ± Ø¨ÛŒÙ† Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
},
      "system-crash": () => {
         if(system.checkpoints.length === 0) {
      addLog(currentLanguage === "fa"
        ? "âš ï¸ Ù‡ÛŒÚ† Ú†Ú© Ù¾ÙˆÛŒÙ†ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯! Ø§ÛŒØ¬Ø§Ø¯ Ú†Ú© Ù¾ÙˆÛŒÙ†Øª Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ..."
        : "âš ï¸ No checkpoint found! Creating emergency checkpoint...",
        "warning");
      createCheckpoint();
    }

    addLog(currentLanguage === "fa"
      ? "ğŸ–¥ Ø´Ú©Ø³Øª Ø³ÛŒØ³ØªÙ…! Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ú†Ú© Ù¾ÙˆÛŒÙ†Øª..."
      : "ğŸ–¥ System crash! Recovering from last checkpoint...",
      "danger");

    setTimeout(() => {
      recoverFromCheckpoint();
      addLog(currentLanguage === "fa"
        ? "âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
        : "âœ… Recovery succeeded",
        "success");
        updateUI();

        }, 1000);
      },
      "two-phase": () => {
        runTwoPhaseCommit();
      }
    };

    // Create a transaction (standard)
    function createTransaction() {
      transactionCounter++;
      const tid = `T${transactionCounter}`;
      const newTrans = {
        id: tid,
        state: "ÙØ¹Ø§Ù„",
        operations: [
          { type: "read", item: "A" },
          { type: "write", item: "A", old: system.data.A, new: system.data.A - 50 },
          { type: "write", item: "B", old: system.data.B, new: system.data.B + 50 },
          { type: "commit" }
        ]
      };
      system.transactions.push(newTrans);
      addLog(currentLanguage === "fa" ? `âœ… ØªØ±Ø§Ú©Ù†Ø´ ${tid} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯` : `âœ… Transaction ${tid} created`, "info");
      processTransaction(newTrans);
      updateUI();
    }

    // Process a transaction (standard) â€“ log WAL only once per transaction
    function processTransaction(trans) {
      let walLogged = false;
      trans.operations.forEach(op => {
        if(op.type === "write") {
          if(!walLogged) {
            const logEntry = new LogEntry(trans.id, "UPDATE", { item: op.item, old: op.old, new: op.new });
            system.logStorage.active.push(logEntry);
            addLog(currentLanguage === "fa" ? `ğŸ“ WAL: Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ ${trans.id} Ø«Ø¨Øª Ø´Ø¯` : `ğŸ“ WAL: Log recorded for ${trans.id}`, "warning");
            walLogged = true;
          }
          system.buffer.push({ item: op.item, value: op.new });
        }
      });
      setTimeout(() => {
        if(flushBuffer()){
          addLog(currentLanguage === "fa" ? `ğŸ’¾ ÙÙ„Ø§Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯ÛŒØ³Ú© Ø¨Ø±Ø§ÛŒ ${trans.id}` : `ğŸ’¾ Data flushed to disk for ${trans.id}`, "success");
        }
        updateUI();
      }, 1000);
    }

    // Create checkpoint
    function createCheckpoint() {
      const checkpointData = {
        timestamp: new Date().toLocaleString(),
        data: JSON.parse(JSON.stringify(system.data)),
        logs: [...system.logStorage.active]
      };
      system.checkpoints.push(checkpointData);
      addLog(currentLanguage === "fa" ? `ğŸ”– Ú†Ú© Ù¾ÙˆÛŒÙ†Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯ (${checkpointData.timestamp})` : `ğŸ”– Checkpoint created (${checkpointData.timestamp})`, "info");
      document.getElementById("lastCheckpoint").textContent = checkpointData.timestamp;
      compressLogs();
      updateUI();
    }

    function compressLogs() {
      system.logStorage.archive = system.logStorage.active.filter(log =>
        !system.transactions.some(t => t.id === log.tid && t.state === "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡")
      );
      addLog(currentLanguage === "fa" ? "ğŸ“œ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ÙØ´Ø±Ø¯Ù‡ Ø´Ø¯Ù†Ø¯" : "ğŸ“œ Logs compressed", "warning");
    }

    // Simulate failure on a random transaction
    function simulateFailure() {
      const activeTransactions = system.transactions.filter(t => t.state === "ÙØ¹Ø§Ù„");
      if(activeTransactions.length === 0) {
        addLog(currentLanguage === "fa" ? "âš ï¸ Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!" : "âš ï¸ No active transaction available for failure!", "warning");
        return;
      }
      const failedTrans = activeTransactions[Math.floor(Math.random() * activeTransactions.length)];
      failedTrans.state = "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡";
      addLog(currentLanguage === "fa" ? `ğŸ’¥ ØªØ±Ø§Ú©Ù†Ø´ ${failedTrans.id} Ø¨Ù‡ ØµÙˆØ±Øª ØªØµØ§Ø¯ÙÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯` : `ğŸ’¥ Transaction ${failedTrans.id} failed randomly`, "danger");
      executeUndo(failedTrans);
      updateUI();
    }

    // Simulate system crash with recovery
    function simulateSystemCrash() {
      system.diskStatus = "Ø®Ø±Ø§Ø¨";
      addLog(currentLanguage === "fa" ? "ğŸ”– Ú†Ú© Ù¾ÙˆÛŒÙ†Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯" : "ğŸ”– Checkpoint created", "info");
      createCheckpoint();
      setTimeout(() => {
        addLog(currentLanguage === "fa" ? "ğŸ–¥ Ø´Ú©Ø³Øª Ø³ÛŒØ³ØªÙ…! Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Checkpoint..." : "ğŸ–¥ System crash! Recovering from last checkpoint...", "danger");
        recoverFromCheckpoint();
        addLog(currentLanguage === "fa" ? "âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯" : "âœ… Recovery succeeded", "success");
        updateUI();
      }, 1000);
    }

    // Toggle Disk Status button function
    function toggleDiskStatus() {
      if(system.diskStatus === "Ø³Ø§Ù„Ù…") {
        system.diskStatus = "Ø®Ø±Ø§Ø¨";
        addLog(currentLanguage === "fa" ? "âŒ ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© Ø¨Ù‡ Ø®Ø±Ø§Ø¨ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª" : "âŒ Disk status changed to broken", "danger");
      } else {
        system.diskStatus = "Ø³Ø§Ù„Ù…";
        addLog(currentLanguage === "fa" ? "âœ… ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© Ø¨Ù‡ Ø³Ø§Ù„Ù… ØªØºÛŒÛŒØ± ÛŒØ§ÙØª" : "âœ… Disk status changed to healthy", "success");
      }
      updateUI();
    }

    // Two-Phase Commit simulation
    function runTwoPhaseCommit() {
      transactionCounter++;
      const tid = `T${transactionCounter}`;
      const newTrans = {
        id: tid,
        state: "ÙØ¹Ø§Ù„",
        twoPhase: true,
        operations: [
          { type: "read", item: "A" },
          { type: "write", item: "A", old: system.data.A, new: system.data.A - 100 },
          { type: "write", item: "B", old: system.data.B, new: system.data.B + 100 },
          { type: "commit" }
        ]
      };
      system.transactions.push(newTrans);
      addLog(currentLanguage === "fa" ? `ğŸ¤ ØªØ±Ø§Ú©Ù†Ø´ Two-Phase ${tid} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯` : `ğŸ¤ Two-Phase Transaction ${tid} created`, "info");

      // Prepare Phase
      addLog(currentLanguage === "fa" ? "ğŸ¤ Two-Phase Commit: ÙØ§Ø² Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯" : "ğŸ¤ Two-Phase Commit: Prepare phase started", "info");
      if(system.diskStatus !== "Ø³Ø§Ù„Ù…") {
        addLog(currentLanguage === "fa" ? "âŒ Two-Phase Commit: ÙØ§Ø² Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø®Ø±Ø§Ø¨ÛŒ Ø¯ÛŒØ³Ú© Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯" : "âŒ Two-Phase Commit: Prepare phase failed due to disk failure", "danger");
        newTrans.state = "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡";
        executeUndo(newTrans);
        updateUI();
        return;
      } else {
        addLog(currentLanguage === "fa" ? "âœ… Two-Phase Commit: ÙØ§Ø² Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯" : "âœ… Two-Phase Commit: Prepare phase succeeded", "success");
      }
      // Commit Phase
      if(flushBuffer()){
        newTrans.state = "ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡";
        addLog(currentLanguage === "fa" ? "âœ… Two-Phase Commit: ÙØ§Ø² commit Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯" : "âœ… Two-Phase Commit: Commit phase succeeded", "success");
      }
      updateUI();
    }

    function executeUndo(trans) {
      trans.operations.slice().reverse().forEach(op => {
        if(op.type === "write") {
          const before = system.data[op.item];
          system.data[op.item] = op.old;
          addLog(currentLanguage === "fa" ? `â†©ï¸ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ ${op.item} Ø§Ø² ${before} Ø¨Ù‡ ${op.old} (Ø¹Ù…Ù„ÛŒØ§Øª ${op.type} ØªØ±Ø§Ú©Ù†Ø´ ${trans.id})` : `â†©ï¸ Undo: ${op.item} reverted from ${before} to ${op.old} (Transaction ${trans.id})`, "warning");
        }
      });
      updateUI();
    }

    function executeRedo() {
      if(system.logStorage.active.length === 0) {
        addLog(currentLanguage === "fa" ? "âš ï¸ Ù‡ÛŒÚ† Ù„Ø§Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Redo ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!" : "âš ï¸ No log available for Redo!", "warning");
        return;
      }
      system.logStorage.active.forEach(log => {
        if(log.type === "UPDATE") {
          const curr = system.data[log.data.item];
          system.data[log.data.item] = log.data.new;
          addLog(currentLanguage === "fa" ? `â†ªï¸ Redo: ${log.data.item} Ø§Ø² ${curr} Ø¨Ù‡ ${log.data.new}` : `â†ªï¸ Redo: ${log.data.item} changed from ${curr} to ${log.data.new}`, "success");
        }
      });
      updateUI();
    }

    // Flush buffer only if disk is healthy; returns true if flush succeeded, false otherwise.
    function flushBuffer() {
      if(system.diskStatus !== "Ø³Ø§Ù„Ù…") {
        addLog(currentLanguage === "fa" ? "âŒ ÙÙ„Ø§Ø´ Ø¨Ø§ÙØ± Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯: Ø¯ÛŒØ³Ú© Ø®Ø±Ø§Ø¨ Ø§Ø³Øª." : "âŒ Buffer flush aborted: Disk is broken.", "danger");
        return false;
      }
      system.buffer.forEach(entry => {
        system.data[entry.item] = entry.value;
      });
      system.buffer = [];
      return true;
    }

    // Dump operation implementation (with disk check)
    function simulateDump() {
      const activeTransactions = system.transactions.filter(t => t.state === "ÙØ¹Ø§Ù„");
      if(activeTransactions.length > 0) {
        addLog(currentLanguage === "fa" ? "âŒ Ù‚Ø¨Ù„ Ø§Ø² DumpØŒ Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ø§Ù„ Ù†Ø¨Ø§ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯!" : "âŒ No transaction may be acting during dump!", "danger");
        return;
      }
      if(system.diskStatus !== "Ø³Ø§Ù„Ù…") {
        addLog(currentLanguage === "fa" ? "âŒ Dump Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯: Ø¯ÛŒØ³Ú© Ø®Ø±Ø§Ø¨ Ø§Ø³Øª." : "âŒ Dump aborted: Disk is broken.", "danger");
        return;
      }
      // 1. Output all log records in MM to stable storage
      system.logStorage.archive = system.logStorage.archive.concat(system.logStorage.active);
      system.logStorage.active = [];
      addLog(currentLanguage === "fa" ? "ğŸ“œ ØªÙ…Ø§Ù… Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡ Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù†Ø¯." : "ğŸ“œ All in-memory log records output to stable storage.", "success");
      // 2. Flush buffer to disk (if disk is healthy â€“ already checked)
      if(flushBuffer()){
        addLog(currentLanguage === "fa" ? "ğŸ’¾ ÙÙ„Ø§Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯ÛŒØ³Ú© Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯." : "ğŸ’¾ Data flushed to disk successfully.", "success");
      }
      // 3. Copy the content of the DB to stable storage
      system.stableDB = JSON.parse(JSON.stringify(system.data));
      addLog(currentLanguage === "fa" ? "ğŸ—„ Ù…Ø­ØªÙˆÛŒØ§Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ú©Ù¾ÛŒ Ø´Ø¯." : "ğŸ—„ DB content copied to stable storage.", "success");
      // 4. Output a log record <dump> onto the stable storage
      const dumpLog = new LogEntry("SYSTEM", "DUMP", { message: "<dump>" });
      system.logStorage.archive.push(dumpLog);
      addLog(currentLanguage === "fa" ? "ğŸ“ Ø±Ú©ÙˆØ±Ø¯ Ù„Ø§Ú¯ <dump> Ø¨Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯." : "ğŸ“ Log record <dump> output to stable storage.", "success");
    }

    function resetSystem() {
      system = {
        data: { A: 1000, B: 2000 },
        transactions: [],
        logs: [],
        checkpoints: [],
        buffer: [],
        diskStatus: "Ø³Ø§Ù„Ù…",
        stableDB: {},
        logStorage: { active: [], archive: [] }
      };
      transactionCounter = 0;
      updateUI();
      addLog(currentLanguage === "fa" ? "ğŸ”„ Ø³ÛŒØ³ØªÙ… Ø±ÛŒØ³Øª Ø´Ø¯" : "ğŸ”„ System reset", "info");
    }

    class LogEntry {
      constructor(tid, type, data) {
        this.tid = tid;
        this.type = type;
        this.data = data;
        this.timestamp = new Date().toISOString();
      }
    }

    function addLog(message, type) {
      const logTypes = {
        info: { color: "#17a2b8", icon: "â„¹ï¸" },
        success: { color: "#28a745", icon: "âœ…" },
        warning: { color: "#ffc107", icon: "âš ï¸" },
        danger: { color: "#dc3545", icon: "âŒ" }
      };
      const logEntry = document.createElement("div");
      logEntry.className = "log-entry";
      logEntry.style.borderColor = logTypes[type].color;
      logEntry.innerHTML = `
        <div class="d-flex align-items-center">
          <span style="width: 30px">${logTypes[type].icon}</span>
          <div>
            <strong>[${new Date().toLocaleTimeString()}]</strong><br/>
            ${message}
          </div>
        </div>
      `;
      document.getElementById("systemLogs").prepend(logEntry);
    }

    function updateUI() {
      document.getElementById("dataA").textContent = system.data.A ?? "Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…";
      document.getElementById("dataB").textContent = system.data.B ?? "Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…";
      document.getElementById("transactions").innerHTML =
        system.transactions.map(t => `
          <div class="phase alert ${t.state === "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡" ? "alert-danger" : "alert-primary"}">
            ${t.id} - ${t.state}
            <button class="btn btn-danger btn-sm" onclick="deleteTransaction('${t.id}')" data-tooltip-key="tooltipDeleteTransaction">âœ–ï¸</button>
          </div>
        `).join("");
      let diskStatusDisplay = system.diskStatus;
      if(currentLanguage === "en") {
        diskStatusDisplay = (system.diskStatus === "Ø³Ø§Ù„Ù…") ? "Healthy" : "Broken";
      }
      document.getElementById("diskState").textContent = `${translations.diskStatusLabel[currentLanguage]} ${diskStatusDisplay}`;
      document.getElementById("diskState").className = system.diskStatus === "Ø³Ø§Ù„Ù…" ? "text-success" : "text-danger";
      document.getElementById("bufferedData").textContent = system.buffer.length;
      document.getElementById("bufferContent").innerHTML = system.buffer.map(entry => `
        <div class="data-item">${entry.item}: ${entry.value}</div>
      `).join("");
      // Ø¯Ø± ØªØ§Ø¨Ø¹ updateUI
    document.getElementById("lastCheckpoint").textContent =
        system.checkpoints.length > 0 
        ? system.checkpoints[system.checkpoints.length - 1].timestamp 
        : translations.noCheckpoint[currentLanguage];
    document.getElementById("bufferedData").innerHTML = system.buffer.length > 0
         ? system.buffer.map(b => `${b.item}: ${b.value}`).join(", ")
        : translations.noBuffer[currentLanguage];
    }

    function runScenario() {
      const scenario = document.getElementById("scenarioSelector").value;
      scenarios[scenario]();
      updateUI();
    }

    function failRandomTransaction() {
      const activeTransactions = system.transactions.filter(t => t.state === "ÙØ¹Ø§Ù„");
      if(activeTransactions.length > 0) {
        const t = activeTransactions[Math.floor(Math.random() * activeTransactions.length)];
        t.state = "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡";
        addLog(currentLanguage === "fa" ? `ğŸ’¥ ØªØ±Ø§Ú©Ù†Ø´ ${t.id} Ø¨Ù‡ ØµÙˆØ±Øª ØªØµØ§Ø¯ÙÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯` : `ğŸ’¥ Transaction ${t.id} failed randomly`, "danger");
        executeUndo(t);
      }
      updateUI();
    }

    // Recovery from checkpoint (for system crash)
    function recoverFromCheckpoint() {
      if(system.checkpoints.length === 0) return;
      const lastCheckpoint = system.checkpoints[system.checkpoints.length - 1];
      system.data = JSON.parse(JSON.stringify(lastCheckpoint.data));
      system.logStorage.active = lastCheckpoint.logs;
      system.transactions.forEach(t => {
        if(t.state !== "ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡") t.state = "Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡";
      });
      updateUI();
    }

    // Undo the last committed transaction
    function undoLastTransaction() {
      for(let i = system.transactions.length - 1; i >= 0; i--){
        if(system.transactions[i].state === "ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡"){
          executeUndo(system.transactions[i]);
          system.transactions[i].state = "Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯Ù‡";
          addLog(currentLanguage === "fa" ? `â†©ï¸ ØªØ±Ø§Ú©Ù†Ø´ ${system.transactions[i].id} Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯` : `â†©ï¸ Transaction ${system.transactions[i].id} undone`, "warning");
          updateUI();
          return;
        }
      }
      addLog(currentLanguage === "fa" ? "âš ï¸ Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!" : "âš ï¸ No committed transaction available to undo!", "warning");
    }

    // Delete a transaction by id
    function deleteTransaction(id) {
      system.transactions = system.transactions.filter(t => t.id !== id);
      addLog(currentLanguage === "fa" ? `âŒ ØªØ±Ø§Ú©Ù†Ø´ ${id} Ø­Ø°Ù Ø´Ø¯` : `âŒ Transaction ${id} deleted`, "info");
      updateUI();
    }

    // Initialize language and theme on page load
    document.addEventListener("DOMContentLoaded", () => {
      if(localStorage.getItem("darkMode") === "enabled"){
        document.body.classList.add("dark-mode");
      }
      updateLanguage();
    });

    // Theme toggle
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      const darkModeEnabled = document.body.classList.contains("dark-mode");
      localStorage.setItem("darkMode", darkModeEnabled ? "enabled" : "disabled");
      updateUI();
    }

    // Update tooltips based on language
    function updateTooltips() {
      document.querySelectorAll("[data-tooltip-key]").forEach(el => {
        const key = el.getAttribute("data-tooltip-key");
        if(translations[key] && translations[key][currentLanguage]){
          el.title = translations[key][currentLanguage];
        }
      });
    }

    // Extended translation for tooltips
    translations.tooltipNewTransaction = { fa: "Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯", en: "Create a new transaction" };
    translations.tooltipCommitAll = { fa: "ØªØ§ÛŒÛŒØ¯ ØªÙ…Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„", en: "Commit all active transactions" };
    translations.tooltipCheckpoint = { fa: "Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ú†Ú© Ù¾ÙˆÛŒÙ†Øª", en: "Create a checkpoint" };
    translations.tooltipSimulateFailure = { fa: "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ú©Ø³Øª ØªØ±Ø§Ú©Ù†Ø´", en: "Simulate a transaction failure" };
    translations.tooltipFlushBuffer = { fa: "ÙÙ„Ø§Ø´ Ú©Ø±Ø¯Ù† Ø¨Ø§ÙØ± Ø¨Ù‡ Ø¯ÛŒØ³Ú©", en: "Flush the buffer to disk" };
    translations.tooltipToggleDisk = { fa: "ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© (Ø³Ø§Ù„Ù…/Ø®Ø±Ø§Ø¨)", en: "Toggle disk status (Healthy/Broken)" };
    translations.tooltipRunScenario = { fa: "Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡", en: "Run the selected scenario" };
    translations.tooltipDump = { fa: "Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø² ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…", en: "Dump the system state" };
    translations.tooltipResetSystem = { fa: "Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø³ÛŒØ³ØªÙ…", en: "Reset the system" };
    translations.tooltipRedo = { fa: "Ø§Ø¹Ù…Ø§Ù„ Ù…Ø¬Ø¯Ø¯ ØªØºÛŒÛŒØ±Ø§Øª", en: "Redo changes" };
    translations.tooltipClearLogs = { fa: "Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù„Ø§Ú¯â€ŒÙ‡Ø§", en: "Clear all logs" };
    translations.tooltipToggleTheme = { fa: "ØªØºÛŒÛŒØ± ØªÙ…", en: "Toggle theme" };
    translations.tooltipAbout = { fa: "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø³ÛŒØ³ØªÙ…", en: "About this system" };
    translations.tooltipGuide = { fa: "Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³ÛŒØ³ØªÙ…", en: "Usage guide" };
    translations.tooltipToggleLanguage = { fa: "ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†", en: "Toggle language" };
    translations.tooltipUndo = { fa: "Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡", en: "Undo the last committed transaction" };
    translations.tooltipDeleteTransaction = { fa: "Ø­Ø°Ù Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´", en: "Delete this transaction" };

    // Final UI update for tooltips
    function updateUIWithTooltips() {
      updateUI();
      updateTooltips();
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
